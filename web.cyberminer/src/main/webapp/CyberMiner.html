<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CYBERMINER</title>
  
  <link rel="stylesheet" href="stylesheets/css/cyberminer.css" type="text/css" />
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="jquery.twbsPagination.min.js"></script>
  <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="KWICIndex.js"></script>
  
  <script type="text/javascript">
  $(function() {
		$("#toolbar").hide();
		$("#searchResults").hide();
		
		var successResult = function(response) {

			for(var i = 0; i < response.data.length; i++) {
				if(response.data[i].description != null) {
					searchResults.push(new KWICIndex(response.data[i].url, response.data[i].description));
				}
			}
			
			updateResults();
		}
		
		var searchResults;
		var search = function(event) {
			searchResults = [];
			
			var searchInput;
			if($(this).attr("id") == "searchButton") {
				searchInput = $("#input").val();
				
				$("#inputToolbar").val(searchInput);
			}
			if($(this).attr("id") == "searchButtonToolbar") {
				searchInput = $("#inputToolbar").val();
			}
			
	  		$.ajax({
			    type: "GET",
			    url: "http://localhost:8080/web.cyberminer/api/v1/indices/search?q="+searchInput,
			    success: successResult
			});
	  		
			$("#toolbar").show();
	  		$("#searchResults").show();
			$("#navigationBar").hide();
			$("#main").hide();
		}
		
		$("#searchButton").button({icons: {primary: "search"}}).click(search);
		
		$("#searchButtonToolbar").button({icons: {primary: "search"}}).click(search);
		
        $(".kwic").click(function( event ) {
	   		 window.location.href = "http://localhost:8080/web.cyberminer/KWIC.html";
	   	});
        
        function updateResults() {
	  		var itemsPerPage = 3;
	  		
	  		var total = Math.ceil(searchResults.length/itemsPerPage);
	  		var visible = 3;
	  		
	  		if(total < 3) {
	  			visible = total;
	  		}
	  		
	  		$("#searchResults").empty();
	  		$("#searchResults").append("<div id='page-content'></div>");
	  		$("#searchResults").append("<ul id='pagination' class='pagination-sm'></ul>");
	  		
	  		if (searchResults.length <= 0) {
        		$('#page-content').empty();
        		$('#pagination').hide();
        		$('#page-content').append("<div style='width:100%; float:left; margin-top: 15px; margin-left: 15px;'><h4>Nothing found.</h4></div>");
        	} else {
        		$('#page-content').empty();
        		$('#pagination').show();
        	}
	  		
        	$('#pagination').twbsPagination({
                totalPages: total,
                visiblePages: visible,
                onPageClick: function (event, page) {
                	$('#page-content').empty();
                	
                    for(var i = (itemsPerPage*(page-1)); i < (itemsPerPage*page); i++){
                    	$('#page-content').append("<div style='width:100%; float:left; margin-top: 15px; margin-left: 15px;'><h4>"+(i+1)+". "+searchResults[i].description+"</h4></div>");
                    	$('#page-content').append("<div style='width:100%; float:left; margin-left: 15px;'><a href='"+searchResults[i].url+"' style='width:100%; float:left;'>"+searchResults[i].url+"</a></div>");
                    }
                }
            });
        }
        
        var autocompletion = function(response) {
        	$("#input").autocomplete({
                source: response.data
            });
        }
        
        $("#input").on('input',function(e){
        	$.ajax({
			    type: "GET",
			    url: "http://localhost:8080/web.cyberminer/api/v1/indices/search/suggest?q="+$("#input").val(),
			    success: autocompletion
			});
        });
        
        var toolbarAutocompletion = function(response) {
        	$("#inputToolbar").autocomplete({
                source: response.data
            });
        }
        
        $("#inputToolbar").on('input',function(e){
        	$.ajax({
			    type: "GET",
			    url: "http://localhost:8080/web.cyberminer/api/v1/indices/search/suggest?q="+$("#inputToolbar").val(),
			    success: toolbarAutocompletion
			});
        });
        
  });
  </script>
</head>
<body>
<!-- TOOLBAR -->
<div id="toolbar" class="toolbar ui-widget-content">
	<img src='stylesheets/images/cyberminer-logo.png' width="200" height="50" style="margin-top: 10px; margin-bottom: 15px; float:left;">
	<input type="text" id="inputToolbar" value="" style="width:30%; height:32px; margin-top: 15px; margin-bottom: 15px; float:left;">
	<button id="searchButtonToolbar" style="margin-top: 15px; margin-bottom: 15px; float:left;">Search</button>
	<img class="kwic" src='stylesheets/images/kwic-logo.gif' width="200" height="50" style="margin-top: 10px; margin-bottom: 15px; float:right;">
</div>
<div id="navigationBar" class="toolbar">
	<img class="kwic" src='stylesheets/images/kwic-logo.gif' width="200" height="50" style="margin-top: 10px; margin-bottom: 15px; float:right;">
</div>

<div id="main">
	<!-- HEADER -->
	<div class="horizontal">
		<img src='stylesheets/images/cyberminer-logo.png'>
	</div>
	
	<!-- INPUT -->
	<div class="horizontal">
		<input type="text" id="input" value="" style="width:30%; height:32px;">
		<button id="searchButton">Search</button>
	</div>
</div>

<!-- Descriptions/Links -->
<div id="searchResults"></div>

</body>
</html>